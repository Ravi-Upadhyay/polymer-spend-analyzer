<!-- 
** LOGIN COMPONENT
* Component will contain login form 
* Takes user input and generate ajax call to authenticate
* After sucessful authentication will call function on parent.
-->

<link rel="import" href="../../bower_components/polymer/polymer-element.html">
<link rel="import" href="../../bower_components/polymer/lib/utils/gestures.html">

<link rel="import" href="../../bower_components/iron-form/iron-form.html">
<link rel="import" href="../../bower_components/paper-button/paper-button.html">
<link rel="import" href="../../bower_components/paper-input/paper-input.html">

<dom-module id="login-form">
  <template>
    <style>
        input[type=text], input[type=password] {
            width: 100%;
            padding: 12px 20px;
            margin: 8px 0;
            display: block;
            border: 1px solid #ccc;
            border-radius: 10px;
            box-sizing: border-box;
            float: center;
        }
        form {
            border: 3px solid #f1f1f1;
            padding: 25px 50px 50px 50px;
        }
        .container {
            /* border: 1px solid #666; */
            border-radius: 10px;
            width: 400px;
            -webkit-box-shadow: 2px 2px 5px 0px rgba(0,0,0,0.75);
            -moz-box-shadow: 2px 2px 5px 0px rgba(0,0,0,0.75);
            box-shadow: 2px 2px 5px 0px rgba(0,0,0,0.75);
            transform: translateY(20%);
            margin: auto auto;
        }
        .heading {
            padding-top: 25px;
            padding-left: 50px;
        }
        hr {
            width: 78%;
            border: 2px solid #ff6200;
            border-radius: 5px;
        }
        #submit {
            display: block;
            padding: 10px 25px 10px 25px;
            margin-left: auto;
            margin-right: auto;
            margin-top: 35px;
            margin-bottom: 0;
            border-radius: 10px;
            background-color:midnightblue;
            color: white;
            border: 1px solid midnightblue;
        }
        #submit:hover {
            cursor: pointer;
        }
        .input {
            margin-top: 1rem;
        }
    </style>
    <!-- <h2>Hello [[prop1]]!</h2> -->
    <div class="container">
        <h2 class="heading"><b>Login</b></h2>
        <hr>
        <iron-form id="myForm"> 
        <form>
            <div class="input">
                <label><b>Login id</b></label>
                <paper-input type="text" label="Username" id="username" no-label-float value="{{username}}" on-change="_removeInvalid" required></paper-input>
            </div>
            <div class="input">
                <label class="label"><b>Password</b></label>
                <paper-input type="password" label="Password" id="password" no-label-float value="{{password}}" on-change="_removeInvalid" required></paper-input>
            </div>
            <!-- <span class="forgot-pwd"><a href="#" style="text-decoration: none">Forgot password?</a></span> -->
            <iron-request id="xhr"></iron-request>
            
          <button id="submit" on-click="login" disabled="[[loginBtnDisabled]]">Login</button>
        </form>
     </iron-form>
    </div>
    <app-location route="{{route}}"></app-location>
  </template>

  <script>
    /**
     * @customElement
     * @polymer
     */
    class LoginForm extends Polymer.Element {
      static get is() { return 'login-form'; }
      static get properties() {
        return {
            loginSuccess : {
                type: Object,
            },
            username: {
                type    : String,
                value   : ""
            },
            password: {
                type    : String,
                value   : ""
            },
            loginBtnDisabled : {
                type    : Boolean,
                value   : true,
                computed: '_toggleLoginBtn(username,password)'
            },
            userDetails: {
                type: Object,
                value: {}
            },
            ajaxResponse: {
            type: String,
            value: []
            }
        };
      }

      constructor(){
          super();
        //   window.setTimeout(()=> console.log(this.loginSuccess),5000);
        // window.setInterval(()=>{
        //     // console.log(`From LF, isLoggedIn: ${this.isLoggedIn}`);
        //     // console.log(this.context);
        //     },5000);

      }

      login() {
          this.userDetails = {
              loginId: this.username,
              password: this.password
          }
        var post_req = this.$.xhr;
        post_req.send({url: "src/data/login-success.json"});
        post_req.completes.then((argReceived) => {
            let response    = JSON.parse(argReceived.response);
            let status      = response.status;
            if(status){
                this.loginSuccess(response.data[0])
            }
            else{
                //TODO: display proper message somewhere
                this.$.username.invalid = true;
                this.$.password.invalid = true;
                this.password = "";
            }
        }, function(){
            console.log('I am failed');
            //TODO: display proper page, unable to hit server properly 500
        });
      }

      _toggleLoginBtn(loginId, password){
          // FUNCTION: This function will validate loginId and password should
          // have some value before they hit api 
          if((loginId.length > 4) && (password.length > 8)) return false;
          else return true;
      }

      _removeInvalid(){
        // FUNCTION: This function will take care, if we have inputs in invalid state
        // We need to remove that state when user changes the value
        this.$.username.invalid = false;
        this.$.password.invalid = false;
      }
    }

    window.customElements.define(LoginForm.is, LoginForm);
  </script>
</dom-module>
