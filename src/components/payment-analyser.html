<link rel="import" href="../../bower_components/polymer/polymer-element.html">


<link rel="import" href="../../bower_components/iron-ajax/iron-ajax.html">
<link rel="import" href="../../bower_components/vaadin-grid/vaadin-grid.html">
<link rel="import" href="../../bower_components/vaadin-grid/vaadin-grid-selection-column.html">
<link rel="import" href="../../bower_components/vaadin-grid/vaadin-grid-sorter.html">

<link rel="import" href="shared-styles.html">
<link rel="import" href="common-styles.html">
<link rel="import" href="bar-chart-component.html">

<dom-module id="payment-analyser">
    <template>
        <style include="common-styles">                  
            .amcharts-chart-div a{
                display: none !important;
            }          
        </style>
        <style include="shared-styles">
         
        </style>
        <iron-ajax id="analyser" handle-as="json" last-response="{{activities}}" on-response="_handleResponse"></iron-ajax>
        <div class="container fntFamily">
            <h2 class="centerText"> Account Activity Analysis </h2>

            <vaadin-grid id="analyser_grid" class="gridBorder" theme="row-dividers" items="[[activities]]" page-size="10" height-by-rows column-reordering-allowed>
                <vaadin-grid-column items="[[activities]]" id="border">
                    <template class="header"><strong>#</strong></template>
                    <template>
                        <div class="vaadinCol">[[displayIndex(index)]]</div>
                    </template>
                </vaadin-grid-column>
                <vaadin-grid-column>
                    <template class="header"><strong>Month</strong></template>
                    <template>[[item.month]]</template>
                </vaadin-grid-column>

                <vaadin-grid-column>
                    <template class="header"><strong>Total Transaction</strong></template>
                    <template>[[addCurrency(item.totalTransaction)]]</template>
                </vaadin-grid-column>
        
                <vaadin-grid-column>
                    <template class="header"><strong>Debit</strong></template>
                    <template>[[addCurrency(item.debit)]]</template>
                </vaadin-grid-column>
        
                <vaadin-grid-column>
                    <template class="header"><strong>Credit</strong></template>
                    <template class="border">[[addCurrency(item.credit)]]</template>
                </vaadin-grid-column>            
            </vaadin-grid>     

            <h2 class="centerText">Spend Analyser</h2>
            <barchart-component transactions=[[transactions]]></barchart-component>
        </div>
    </template>
    <script>
        class paymentAnalyser extends Polymer.Element{
            static get is(){ return 'payment-analyser'}
            static get properties(){
                return  {
                   spendChart : {},
                   transactions: {
                       type:Array,
                   }
                }
            }
            
            ready(){
                super.ready();
                Polymer.RenderStatus.afterNextRender(this,function(){
                    this._getTransactionData();                    
                })
            }
            
            //Increment by 1 to index in dom-repeat
            displayIndex(index){
                return index + 1;
            }            

            // Add currency
            addCurrency(amount){
                return '$' + amount;
            }

            //Get transaction data ffrom API
            _getTransactionData(){
                let ajax = this.$.analyser;
                ajax.url = "src/data/analyser.json";
                ajax.generateRequest(); //trigger the iron-ajax                
            }

            //Store the response 
            _handleResponse(event,request){
                this.transactions = request.response;
            }           
        };
        window.customElements.define(paymentAnalyser.is,paymentAnalyser);
    </script>
</dom-module>