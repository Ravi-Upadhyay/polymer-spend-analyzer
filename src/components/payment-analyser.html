<link rel="import" href="../../bower_components/polymer/polymer-element.html">

<link rel="import" href="shared-styles.html">
<link rel="import" href="../../bower_components/iron-ajax/iron-ajax.html">
<link rel="import" href="../../bower_components/vaadin-grid/vaadin-grid.html">
<link rel="import" href="../../bower_components/vaadin-grid/vaadin-grid-selection-column.html">
<link rel="import" href="../../bower_components/vaadin-grid/vaadin-grid-sorter.html">

<script src="../../bower_components/amcharts/dist/amcharts/amcharts.js"></script>
<script src="../../bower_components/amcharts/dist/amcharts/themes/light.js"></script>
<script src="../../bower_components/amcharts/dist/amcharts/serial.js"></script>

<dom-module id="payment-analyser">
    <template>
        <style include="shared-styles">
            #chartdiv {
                width: 50%;
                height: 500px;
                margin:0 auto;
            }	
            h3{
                text-align:center;
            }
            .amcharts-chart-div a{
                display: none !important;
            }
        </style>
        <iron-ajax auto url="src/data/analyser.json" handle-as="json" last-response="{{users}}" on-response="handleResponse"></iron-ajax>

        <h3> Account Activity Analysis <h3>

        <vaadin-grid id="grid" theme="row-dividers" items="[[users]]" page-size="10" height-by-rows column-reordering-allowed multi-sort>
            <vaadin-grid-column width="9em">
                <template class="header">
                    <vaadin-grid-sorter path="month">Month</vaadin-grid-sorter>
                </template>
                <template>[[item.month]]</template>
            </vaadin-grid-column>

            <vaadin-grid-column width="9em">
                <template class="header">
                    <vaadin-grid-sorter path="totalTransaction">Total Transaction</vaadin-grid-sorter>
                </template>
                <template>[[item.totalTransaction]]</template>
            </vaadin-grid-column>
    
            <vaadin-grid-column width="9em">
                <template class="header">
                    <vaadin-grid-sorter path="debit">Debit</vaadin-grid-sorter>
                </template>
                <template>[[item.debit]]</template>
            </vaadin-grid-column>
    
            <vaadin-grid-column width="9em">
                <template class="header">
                    <vaadin-grid-sorter path="credit">Credit</vaadin-grid-sorter>
                </template>
                <template>[[item.credit]]</template>
            </vaadin-grid-column>            
        </vaadin-grid>
        <!-- <div id="pages">
            <button on-click="_prev">&lt;</button>
            <template is="dom-repeat" items="[[pages]]">
            <button on-click="_select" selected$="[[_isSelected(page, item)]]">[[item]]</button>
            </template>
            <button on-click="_next">&gt;</button>
        </div> -->
        <h3>Spend Analyser</h3>
        <div id="chartdiv"></div>
    </template>
    <script>
        class paymentAnalyser extends Polymer.Element{
            static get is(){ return 'payment-analyser'}
            static get properties(){
                return  {
                   spendChart : {}
                }
            }

            ready(){
                super.ready();
                Polymer.RenderStatus.afterNextRender(this,function(){
                    this._getChartData();                    
                })
            }

            _getChartData(){
                var chartData = [{
                    'month':'Jan',
                    'credit' : '2000',
                    'debit' : '500'
                },{
                    'month':'Feb',
                    'credit' : '3000',
                    'debit' : '100'
                },{
                    'month':'Feb',
                    'credit' : '10000',
                    'debit' : '3500'
                }];
                this._generateChart(chartData);
            }
            // Generate chart from chart data
            _generateChart(data){                
                var Chart = this.$.chartdiv;
                    

                this.spendChart = AmCharts.makeChart(Chart, {
                    "theme": "light",
                    "type": "serial",
                    //"fontSize" : 14,
                    "dataProvider":data,
                    "valueAxes": [{
                        "stackType": "3d",
                        "unit": "",
                        "position": "left",
                        "title": "",
                        "autoGridCount" :false
                    }],
                    // set startDuration to 0 on older browsers
                    "startDuration": this._supportSVG()? 1 : 0,
                    "graphs": [{
                        "balloonText": "Credit in [[category]]: <b>[[value]]</b>",
                        "fillAlphas": 0.9,
                        "lineAlpha": 0.2,
                        "title": "Credit",
                        "type": "column",
                        "fixedColumnWidth": 50,
                        //"colorField": "Ccolor", //chnage color
                        "valueField": "credit"
                    }, {
                        "balloonText": "Debit in [[category]]: <b>[[value]]</b>",
                        "fillAlphas": 0.9,
                        "lineAlpha": 0.2,
                        "title": "Debit",
                        "type": "column",
                        //"colorField": "Dcolor",//chnage color
                        "fixedColumnWidth": 50,
                        "valueField": "debit"
                    }],
                    "plotAreaFillAlphas": 0.1,                
                    "depth3D": 60,
                    "angle": 30,
                    "categoryField": "month",
                    "categoryAxis": {
                        "gridPosition": "start"
                    },    
                    legend: {
                        useGraphSettings: true
                    },
                    "export": {
                        "enabled": true
                    }
                });                
            }
            // Check for SVG support in old browser
            _supportSVG(){
                return !!document.createElementNS && !!document.createElementNS('http://www.w3.org/2000/svg', "svg").createSVGRect;
            }
        };
        window.customElements.define(paymentAnalyser.is,paymentAnalyser);
    </script>
</dom-module>